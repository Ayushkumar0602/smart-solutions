<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | Productivity App</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-light: #6366f1;
            --primary-dark: #4338ca;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #e2e8f0;
            --border-color: #e2e8f0;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
        }

        [data-theme="dark"] {
            --primary-color: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --border-color: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
            transition: var(--transition);
        }

        a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        button {
            cursor: pointer;
            font-family: inherit;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .header {
            padding: 1.5rem 0;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: var(--shadow-sm);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--radius-sm);
            font-weight: bold;
        }

        .nav {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav-link {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .nav-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .main {
            flex: 1;
            padding: 3rem 0;
        }

        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-md);
        }

        .settings-header {
            margin-bottom: 2rem;
        }

        .settings-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .settings-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .back-link:hover {
            color: var(--primary-color);
            text-decoration: none;
        }

        .back-link svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .settings-section {
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .theme-switcher {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .theme-option {
            flex: 1;
            max-width: 200px;
        }

        .theme-radio {
            display: none;
        }

        .theme-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            padding: 1.5rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--bg-primary);
        }

        .theme-radio:checked + .theme-label {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }

        .theme-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-tertiary);
        }

        .theme-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .toggle-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .toggle-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.25rem;
            background-color: var(--bg-primary);
            border-radius victoryDecal: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }

        .toggle-label {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .toggle-title {
            font-weight: 500;
            color: var(--text-primary);
        }

        .toggle-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            transition: var(--transition);
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            transition: var(--transition);
            border: none;
            background-color: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn:hover {
            background-color: var(--primary-dark);
            box-shadow: var(--shadow-md);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .btn-icon {
            margin-right: 0.5rem;
        }

        .footer {
            padding: 1.5rem 0;
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-primary);
        }

        .footer-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background-color: var(--success-color);
            color: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 100;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading {
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loader {
            width: 3rem;
            height: 3rem;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        /* New additions */
        .color-picker-group {
            margin-top: 1.5rem;
        }

        .color-picker-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .color-option {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .color-option.selected {
            border-color: var(--text-primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            transform: scale(1.1);
        }

        .focus-mode-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .focus-mode-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background-color: var(--bg-primary);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .focus-mode-option:hover {
            transform: translateY(-2px);
        }

        .focus-mode-option.selected {
            border-left: 4px solid var(--primary-color);
        }

        .focus-mode-icon {
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-sm);
        }

        .focus-mode-details {
            flex: 1;
        }

        .focus-mode-title {
            font-weight: 500;
            color: var(--text-primary);
        }

        .focus-mode-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .slider-container {
            margin-top: 1.5rem;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .slider-value {
            font-weight: 500;
            color: var(--primary-color);
        }

        .range-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: var(--bg-tertiary);
            border-radius: 5px;
            outline: none;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }

        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .display-language {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        .display-language:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }

        .reset-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .reset-btn {
            background-color: var(--error-color);
        }

        .reset-btn:hover {
            background-color: #dc2626;
        }

        .account-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .avatar {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            object-fit: cover;
            background-color: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .account-details {
            flex: 1;
        }

        .account-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .account-email {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .premium-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background-color: #f5f3ff;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #7c3aed;
            margin-top: 0.25rem;
        }

        [data-theme="dark"] .premium-badge {
            background-color: #2e1065;
            color: #a78bfa;
        }

        .export-btn {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            margin-right: 1rem;
        }

        .export-btn:hover {
            background-color: var(--bg-tertiary);
            color: var(--primary-color);
        }

        .hotkey-settings {
            width: 100%;
            margin-top: 1rem;
            border-collapse: collapse;
        }

        .hotkey-settings th, .hotkey-settings td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            text-align: left;
        }

        .hotkey-settings th {
            color: var(--text-secondary);
            font-weight: 500;
            width: 40%;
        }

        .hotkey-settings td {
            font-family: monospace;
        }

        .hotkey-input {
            width: 100%;
            padding: 0.5rem;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .settings-container {
                padding: 1.5rem;
            }

            .theme-switcher {
                flex-direction: column;
                align-items: center;
            }

            .theme-option {
                max-width: 100%;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .settings-container {
                padding: 1rem;
            }

            .header-container, .footer-container {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .nav {
                flex-direction: column;
                gap: 0.75rem;
            }

            .account-info {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container header-container">
            <a href="dashboard.html" class="logo">
                <span class="logo-icon">P</span>
                <span>Productivity App</span>
            </a>
            <nav class="nav">
                <a href="dashboard.html", class="nav-link">Dashboard</a>
                <a href="settings.html", class="nav-link">Settings</a>
                <button id="logout-btn" class="btn">Logout</button>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <a href="dashboard.html" class="back-link">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Back to Dashboard
            </a>

            <div class="settings-container">
                <div class="settings-header">
                    <h1 class="settings-title">Settings</h1>
                    <p class="settings-subtitle">Manage your app preferences and account settings</p>
                </div>

                <!-- Account Section -->
                <div class="settings-section">
                    <h2 class="section-title">Account</h2>
                    <div class="account-info">
                        <div class="avatar" id="user-avatar">
                            <!-- Initial will be inserted here -->
                        </div>
                        <div class="account-details">
                            <div class="account-name" id="user-name">Loading...</div>
                            <div class="account-email" id="user-email">Loading...</div>
                            <div class="premium-badge">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm14.25-1.23c.15.36.15.76.01 1.13-.29.76-.99 1.11-1.73.91l-2.31-.63c-.27-.08-.56-.03-.78.14l-1.74 1.38c-.4.32-.98.26-1.29-.14l-1.88-2.5a6.011 6.011 0 01-1.19-2.89l-.03-.35c0-.41.34-.75.75-.75h7.19c.41 0 .75.32.75.74l.01.14.42 2.76z"/>
                                </svg>
                                PRO Member
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button id="change-avatar" class="btn export-btn">Change Avatar</button>
                        <button id="manage-subscription" class="btn export-btn">Manage Subscription</button>
                    </div>
                </div>

                <!-- Appearance Section -->
                <div class="settings-section">
                    <h2 class="section-title">Appearance</h2>
                    <div class="theme-switcher">
                        <div class="theme-option">
                            <input type="radio" id="light-theme" name="theme" value="light" class="theme-radio">
                            <label for="light-theme" class="theme-label">
                                <div class="theme-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                                    </svg>
                                </div>
                                <span class="theme-name">Light</span>
                            </label>
                        </div>
                        <div class="theme-option">
                            <input type="radio" id="dark-theme" name="theme" value="dark" class="theme-radio">
                            <label for="dark-theme" class="theme-label">
                                <div class="theme-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20", height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                                    </svg>
                                </div>
                                <span class="theme-name">Dark</span>
                            </label>
                        </div>
                    </div>

                    <div class="color-picker-group">
                        <label for="primary-color" class="color-picker-label">Accent Color</label>
                        <div class="color-options">
                            <div class="color-option selected" style="background-color: #4f46e5;" data-color="4f46e5"></div>
                            <div class="color-option" style="background-color: #10b981;" data-color="10b981"></div>
                            <div class="color-option" style="background-color: #3b82f6;" data-color="3b82f6"></div>
                            <div class="color-option" style="background-color: #f59e0b;" data-color="f59e0b"></div>
                            <div class="color-option" style="background-color: #ec4899;" data-color="ec4899"></div>
                            <div class="color-option" style="background-color: #8b5cf6;" data-color="8b5cf6"></div>
                        </div>
                    </div>
                </div>

                <!-- Notifications Section -->
                <div class="settings-section">
                    <h2 class="section-title">Notifications</h2>
                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div class="toggle-label">
                                <span class="toggle-title">Pomodoro Completion</span>
                                <span class="toggle-description">Get notified when a pomodoro session completes</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="pomodoro-notifications">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="toggle-item">
                            <div class="toggle-label">
                                <span class="toggle-title">Break Completion</span>
                                <span class="toggle-description">Get notified when a break session completes</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="break-notifications">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="toggle-item">
                            <div class="toggle-label">
                                <span class="toggle-title">Daily Summary</span>
                                <span class="toggle-description">Get a daily report of your productivity</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="daily-summary-notifications">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="toggle-item">
                            <div class="toggle-label">
                                <span class="toggle-title">Milestones</span>
                                <span class="toggle-description">Receive notifications when you reach milestones</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="milestone-notifications">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Focus Mode Section -->
                <div class="settings-section">
                    <h2 class="section-title">Focus Mode</h2>
                    <div class="focus-mode-options">
                        <div class="focus-mode-option selected">
                            <div class="focus-mode-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </div>
                            <div class="focus-mode-details">
                                <div class="focus-mode-title">Default</div>
                                <div class="focus-mode-description">Standard focus mode with basic restrictions</div>
                            </div>
                        </div>
                        <div class="focus-mode-option">
                            <div class="focus-mode-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                            </div>
                            <div class="focus-mode-details">
                                <div class="focus-mode-title">Strict</div>
                                <div class="focus-mode-description">Blocks all notifications and websites</div>
                            </div>
                        </div>
                        <div class="focus-mode-option">
                            <div class="focus-mode-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                </svg>
                            </div>
                            <div class="focus-mode-details">
                                <div class="focus-mode-title">Zen</div>
                                <div class="focus-mode-description">Minimal distractions with calming elements</div>
                            </div>
                        </div>
                    </div>

                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Focus Mode Intensity</span>
                            <span class="slider-value">50%</span>
                        </div>
                        <input type="range" min="0" max="100" value="50" class="range-slider" id="focus-intensity">
                    </div>
                </div>

                <!-- Preferences Section -->
                <div class="settings-section">
                    <h2 class="section-title">Preferences</h2>
                    <div class="toggle-item">
                        <div class="toggle-label">
                            <span class="toggle-title">Auto Start Pomodoro</span>
                            <span class="toggle-description">Automatically start next pomodoro session after a break</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="auto-start-pomodoro">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="toggle-item" style="margin-top: 1rem;">
                        <div class="toggle-label">
                            <span class="toggle-title">Tab Clutter Warning</span>
                            <span class="toggle-description">Get notified when you have too many open tabs</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="tab-clutter-warning">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div style="margin-top: 1.5rem;">
                        <label for="display-language" class="color-picker-label">Display Language</label>
                        <select id="display-language" class="display-language">
                            <option value="en">English</option>
                            <option value="es">Español</option>
                            <option value="fr">Français</option>
                            <option value="de">Deutsch</option>
                            <option value="ja">日本語</option>
                        </select>
                    </div>
                </div>

                <!-- Keyboard Shortcuts -->
                <div class="settings-section">
                    <h2 class="section-title">Keyboard Shortcuts</h2>
                    <table class="hotkey-settings">
                        <tr>
                            <th>Start/Pause Timer</th>
                            <td><input type="text" class="hotkey-input" value="Ctrl+Space" readonly></td>
                        </tr>
                        <tr>
                            <th>Skip to Next Session</th>
                            <td><input type="text" class="hotkey-input" value="Ctrl+Right" readonly></td>
                        </tr>
                        <tr>
                            <th>Reset Current Session</th>
                            <td><input type="text" class="hotkey-input" value="Ctrl+R" readonly></td>
                        </tr>
                        <tr>
                            <th>Toggle Fullscreen</th>
                            <td><input type="text" class="hotkey-input" value="F11" readonly></td>
                        </tr>
                    </table>
                    <button id="customize-hotkeys" class="btn export-btn" style="margin-top: 1rem;">Customize Shortcuts</button>
                </div>

                <!-- Data Management -->
                <div class="settings-section reset-section">
                    <h2 class="section-title">Data Management</h2>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <button id="export-data" class="btn export-btn">Export Data</button>
                        <button id="import-data" class="btn export-btn">Import Data</button>
                    </div>
                    <button id="reset-settings" class="btn reset-btn">Reset to Default Settings</button>
                </div>

                <button id="save-settings" class="btn" style="margin-top: 2rem;">
                    <svg id="save-icon" xmlns="http://www.w3.org/2000/svg" class="btn-icon" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round", stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span id="save-text">Save Settings</span>
                    <span id="save-loader" class="loading" style="display: none;"></span>
                </button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container footer-container">
            <p class="footer-text">© 2023 Productivity App. All rights reserved.</p>
            <p class="footer-text">v1.1.0</p>
        </div>
    </footer>

    <div id="toast" class="toast">
        <svg xmlns="http://www.w3.org/2000/svg" class="toast-icon" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <span id="toast-message">Settings saved successfully!</span>
    </div>

    <div id="loader" class="loader-container" style="display: none;">
        <div class="loader"></div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyABwi4-Rzl7T1qGLyWAWIAFcUxEivSX_BE",
            authDomain: "whizan-coding--agent.firebaseapp.com",
            projectId: "whizan-coding--agent",
            storageBucket: "whizan-coding--agent.appspot.com",
            messagingSenderId: "798036544047",
            appId: "1:798036544047:web:ff7f8d3c44f40087e8d4da",
            measurementId: "G-8DJEL3Q4RH"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM elements
        const logoutBtn = document.getElementById('logout-btn');
        const saveSettingsBtn = document.getElementById('save-settings');
        const saveText = document.getElementById('save-text');
        const saveIcon = document.getElementById('save-icon');
        const saveLoader = document.getElementById('save-loader');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const loader = document.getElementById('loader');
        const lightThemeRadio = document.getElementById('light-theme');
        const darkThemeRadio = document.getElementById('dark-theme');
        const pomodoroNotifications = document.getElementById('pomodoro-notifications');
        const breakNotifications = document.getElementById('break-notifications');
        const dailySummaryNotifications = document.getElementById('daily-summary-notifications');
        const milestoneNotifications = document.getElementById('milestone-notifications');
        const autoStartPomodoro = document.getElementById('auto-start-pomodoro');
        const tabClutterWarning = document.getElementById('tab-clutter-warning');
        const displayLanguage = document.getElementById('display-language');
        const focusIntensity = document.getElementById('focus-intensity');
        const colorOptions = document.querySelectorAll('.color-option');
        const focusModeOptions = document.querySelectorAll('.focus-mode-option');
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');
        const changeAvatarBtn = document.getElementById('change-avatar');
        const manageSubscriptionBtn = document.getElementById('manage-subscription');
        const exportDataBtn = document.getElementById('export-data');
        const importDataBtn = document.getElementById('import-data');
        const resetSettingsBtn = document.getElementById('reset-settings');
        const customizeHotkeysBtn = document.getElementById('customize-hotkeys');

        // Current user data
        let currentUser = null;
        let userSettings = {
            theme: 'light',
            primaryColor: '4f46e5',
            focusMode: 'default',
            focusIntensity: 50,
            notifications: {
                pomodoro: true,
                break: true,
                dailySummary: true,
                milestones: true
            },
            preferences: {
                autoStartPomodoro: false,
                tabClutterWarning: true,
                language: 'en'
            }
        };

        // Check authentication state
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                updateUserInfo();
                loadUserSettings();
            } else {
                window.location.href = 'login.html';
            }
        });

        // Update user info in UI
        function updateUserInfo() {
            if (currentUser) {
                // Set user avatar with initial
                const initial = currentUser.displayName ? currentUser.displayName.charAt(0).toUpperCase() : currentUser.email.charAt(0).toUpperCase();
                userAvatar.textContent = initial;
                
                // Set name and email
                userName.textContent = currentUser.displayName || currentUser.email;
                userEmail.textContent = currentUser.email;
            }
        }

        // Logout handler
        logoutBtn.addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = 'index.html';
            }).catch((error) => {
                showToast('Error logging out. Please try again.', 'error');
            });
        });

        // Load user settings from Firestore
        function loadUserSettings() {
            loader.style.display = 'flex';
            const userRef = db.collection('users').doc(currentUser.uid);
            
            userRef.onSnapshot((doc) => {
                loader.style.display = 'none';
                if (doc.exists) {
                    const data = doc.data();
                    if (data.settings) {
                        userSettings = data.settings;
                        updateUI();
                    }
                } else {
                    // Create user document if it doesn't exist
                    userRef.set({
                        settings: userSettings,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            }, (error) => {
                loader.style.display = 'none';
                showToast('Error loading settings. Please try again.', 'error');
                console.error('Error loading settings:', error);
            });
        }

        // Update UI with current settings
        function updateUI() {
            // Set theme
            document.documentElement.setAttribute('data-theme', userSettings.theme);
            if (userSettings.theme === 'light') {
                lightThemeRadio.checked = true;
            } else {
                darkThemeRadio.checked = true;
            }

            // Set primary color
            updatePrimaryColor(userSettings.primaryColor);

            // Set notification toggles
            pomodoroNotifications.checked = userSettings.notifications.pomodoro;
            breakNotifications.checked = userSettings.notifications.break;
            dailySummaryNotifications.checked = userSettings.notifications.dailySummary;
            milestoneNotifications.checked = userSettings.notifications.milestones;

            // Set preferences
            autoStartPomodoro.checked = userSettings.preferences.autoStart;
            tabClutterWarning.checked = userSettings.preferences.tabClutterWarning;
            displayLanguage.value = userSettings.preferences.language;
            
            // Set focus mode and intensity
            focusModeOptions.forEach(option => {
                option.classList.remove('selected');
                if (option.querySelector('.focus-mode-title').textContent.toLowerCase() === userSettings.focusMode) {
                    option.classList.add('selected');
                }
            });
            
            focusIntensity.value = userSettings.focusIntensity;
            document.querySelector('.slider-value').textContent = `${userSettings.focusIntensity}%`;
        }

        // Update primary color in UI
        function updatePrimaryColor(color) {
            // Update color options selection
            colorOptions.forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.color === color) {
                    option.classList.add('selected');
                }
            });

            // Set CSS variable (this would be done in a more comprehensive way in a real app)
            document.documentElement.style.setProperty('--primary-color', `#${color}`);
            document.documentElement.style.setProperty('--primary-dark', darkenColor(color, 20));
            document.documentElement.style.setProperty('--primary-light', lightenColor(color, 20));
        }

        // Helper function to darken a color
        function darkenColor(hex, percent) {
            // Implementation would go here
            return `#${hex}`;
        }

        // Helper function to lighten a color
        function lightenColor(hex, percent) {
            // Implementation would go here
            return `#${hex}`;
        }

        // Theme change handlers
        lightThemeRadio.addEventListener('change', () => {
            if (lightThemeRadio.checked) {
                userSettings.theme = 'light';
                document.documentElement.setAttribute('data-theme', 'light');
            }
        });

        darkThemeRadio.addEventListener('change', () => {
            if (darkThemeRadio.checked) {
                userSettings.theme = 'dark';
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        });

        // Color selection handler
        colorOptions.forEach(option => {
            option.addEventListener('click', () => {
                const color = option.dataset.color;
                userSettings.primaryColor = color;
                updatePrimaryColor(color);
            });
        });

        // Focus mode selection handler
        focusModeOptions.forEach(option => {
            option.addEventListener('click', () => {
                focusModeOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                userSettings.focusMode = option.querySelector('.focus-mode-title').textContent.toLowerCase();
            });
        });

        // Focus intensity handler
        focusIntensity.addEventListener('input', () => {
            const value = focusIntensity.value;
            document.querySelector('.slider-value').textContent = `${value}%`;
            userSettings.focusIntensity = parseInt(value);
        });

        // Notification toggle handlers
        pomodoroNotifications.addEventListener('change', () => {
            userSettings.notifications.pomodoro = pomodoroNotifications.checked;
        });

        breakNotifications.addEventListener('change', () => {
            userSettings.notifications.break = breakNotifications.checked;
        });

        dailySummaryNotifications.addEventListener('change', () => {
            userSettings.notifications.dailySummary = dailySummaryNotifications.checked;
        });

        milestoneNotifications.addEventListener('change', () => {
            userSettings.notifications.milestones = milestoneNotifications.checked;
        });

        // Preferences toggle handlers
        autoStartPomodoro.addEventListener('change', () => {
            userSettings.preferences.autoStart = autoStartPomodoro.checked;
        });

        tabClutterWarning.addEventListener('change', () => {
            userSettings.preferences.tabClutterWarning = tabClutterWarning.checked;
        });

        // Language selection handler
        displayLanguage.addEventListener('change', () => {
            userSettings.preferences.language = displayLanguage.value;
        });

        // Save settings handler
        saveSettingsBtn.addEventListener('click', () => {
            saveSettings();
        });

        // Save settings to Firestore
        function saveSettings() {
            saveText.style.display = 'none';
            saveIcon.style.display = 'none';
            saveLoader.style.display = 'inline-block';
            saveSettingsBtn.disabled = true;

            const userRef = db.collection('users').doc(currentUser.uid);
            
            userRef.update({
                'settings': userSettings,
                'updatedAt': firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                saveText.style.display = 'inline';
                saveIcon.style.display = 'inline';
                saveLoader.style.display = 'none';
                saveSettingsBtn.disabled = false;
                showToast('Settings saved successfully!');
            }).catch((error) => {
                saveText.style.display = 'inline';
                saveIcon.style.display = 'inline';
                saveLoader.style.display = 'none';
                saveSettingsBtn.disabled = false;
                showToast('Error saving settings. Please try again.', 'error');
                console.error('Error saving settings:', error);
            });
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toastIcon = toast.querySelector('.toast-icon');
            
            // Set toast content
            toastMessage.textContent = message;

            // Set toast style based on type
            if (type === 'error') {
                toast.style.backgroundColor = 'var(--error-color)';
                toastIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
            } else if (type === 'warning') {
                toast.style.backgroundColor = 'var(--warning-color)';
                toastIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />';
            } else {
                toast.style.backgroundColor = 'var(--success-color)';
                toastIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />';
            }

            // Show toast
            toast.classList.add('show');

            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Account management handlers
        changeAvatarBtn.addEventListener('click', () => {
            showToast('Avatar change functionality coming soon!', 'warning');
        });

        manageSubscriptionBtn.addEventListener('click', () => {
            showToast('Subscription management dashboard coming soon!', 'warning');
        });

        // Data management handlers
        exportDataBtn.addEventListener('click', () => {
            showToast('Data export functionality coming soon!', 'warning');
        });

        importDataBtn.addEventListener('click', () => {
            showToast('Data import functionality coming soon!', 'warning');
        });

        resetSettingsBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to reset all settings to default? This cannot be undone.')) {
                loader.style.display = 'flex';
                
                // Reset to default settings
                const defaults = {
                    theme: 'light',
                    primaryColor: '4f46e5',
                    focusMode: 'default',
                    focusIntensity: 50,
                    notifications: {
                        pomodoro: true,
                        break: true,
                        dailySummary: true,
                        milestones: true
                    },
                    preferences: {
                        autoStartPomodoro: false,
                        tabClutterWarning: true,
                        language: 'en'
                    }
                };
                
                const userRef = db.collection('users').doc(currentUser.uid);
                userRef.update({
                    'settings': defaults
                }).then(() => {
                    userSettings = defaults;
                    updateUI();
                    loader.style.display = 'none';
                    showToast('Settings reset to default successfully!');
                }).catch(error => {
                    loader.style.display = 'none';
                    showToast('Error resetting settings. Please try again.', 'error');
                });
            }
        });

        // Keyboard shortcuts
        customizeHotkeysBtn.addEventListener('click', () => {
            showToast('Shortcut customization coming soon!', 'warning');
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                window.location.href = 'dashboard.html';
            }
        });
    </script>
</body>
</html>